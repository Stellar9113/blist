import{r as a,L as e,w as l,ai as s,o as i,c as r,e as t,f as v,n as u,b as n,t as o,aj as d,P as c,k as p,_ as m,ac as y,g as f,J as w,u as g,i as k,ak as _,al as h}from"./vendor-CRD7CLCO.js";import{_ as T,i as j}from"./index-WwQmHM_O.js";const x={class:"file-detail"},W={class:"file-name"},L={key:0,class:"preview-container"},N={key:0,class:"image-preview"},$=["src","alt"],b={key:1,class:"video-preview"},C={key:2,class:"audio-preview"},F=["src"],H={key:3,class:"pdf-preview"},I=["src"],J={key:4,class:"text-preview"},M={key:5,class:"unsupported-preview"},P=T({__name:"detail",setup(T){const P=f();g();const q=a({}),z=a(!1),A=a(null),B=a(null),D=e((()=>{var a;return null==(a=q.value.mimeType)?void 0:a.startsWith("image/")})),E=e((()=>{var a;return null==(a=q.value.mimeType)?void 0:a.startsWith("video/")})),G=e((()=>{var a;return null==(a=q.value.mimeType)?void 0:a.startsWith("audio/")})),K=e((()=>"application/pdf"===q.value.mimeType)),O=e((()=>{var a;return(null==(a=q.value.mimeType)?void 0:a.startsWith("text/"))||"application/json"===q.value.mimeType||"application/javascript"===q.value.mimeType})),Q=a(""),R=a("");l((()=>q.value),(a=>{a&&E.value&&(B.value&&B.value.destroy(),_((()=>{A.value&&(B.value=new h({container:A.value,video:{url:Q.value}}))})))}),{immediate:!0});const S=async()=>{z.value=!0;try{const{data:a}=await j.get(`/api/files/${P.params.id}/preview`);q.value=a,Q.value=a.path,await(async()=>{if(O.value)try{const{data:a}=await j.get(`/api/files/${q.value._id}/content`);R.value=a}catch(a){w.error("加载文本内容失败")}})()}catch(a){console.log(a),w.error("加载文件信息失败")}finally{z.value=!1}};return s((()=>{B.value&&B.value.destroy()})),i((()=>{S()})),(a,e)=>{const l=c,s=d,i=y;return k(),r("div",x,[t(i,null,{header:v((()=>[t(l,null,{default:v((()=>[t(p(m)),n("span",W,o(q.value.originalName),1)])),_:1})])),default:v((()=>[q.value.isFolder?u("",!0):(k(),r("div",L,[D.value?(k(),r("div",N,[n("img",{src:Q.value,alt:q.value.originalName},null,8,$)])):E.value?(k(),r("div",b,[n("div",{id:"dplayer",ref_key:"dplayerContainer",ref:A},null,512)])):G.value?(k(),r("div",C,[n("audio",{src:Q.value,controls:"",class:"audio-player"},"您的浏览器不支持 HTML5 音频播放",8,F)])):K.value?(k(),r("div",H,[n("iframe",{src:Q.value,class:"pdf-viewer"},null,8,I)])):O.value?(k(),r("div",J,[n("pre",null,o(R.value),1)])):(k(),r("div",M,[t(s,{theme:"warning",message:"该文件类型暂不支持预览"})]))]))])),_:1})])}}},[["__scopeId","data-v-09c6442c"]]);export{P as default};
