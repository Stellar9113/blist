import{r as a,o as e,g as s,J as l,u as r,c as t,e as o,f as c,m as d,a4 as u,Q as i,B as n,j as f,P as m,k as p,af as _,ag as h,ah as v,b as y,_ as k,t as b,ac as w,a3 as g,a9 as $,i as j}from"./vendor-CRD7CLCO.js";import{_ as C,i as V}from"./index-WwQmHM_O.js";const x={class:"share-container"},z=C({__name:"share",setup(C){const z=s(),A=r(),B=a({code:""}),I=a(!1),J=a({}),N=[{label:"文件大小",key:"size"},{label:"上传时间",key:"createdAt"},{label:"分享者",key:"owner"}],P=async()=>{try{const{data:a}=await V.post(`/api/files/share/${z.params.id}/verify`,{code:B.value.code});I.value=!0,J.value=a}catch(a){l.error("提取码错误")}},Q=async()=>{try{const{data:a}=await V.post(`/api/files/share/${z.params.id}/download`);$.saveAs(a.url,a.filename)}catch(a){l.error("下载失败")}},R=async()=>{try{await V.post(`/api/files/share/${z.params.id}/save`),l.success("保存成功"),A.push("/home")}catch(a){l.error("保存失败")}};return e((async()=>{try{const{data:a}=await V.get(`/api/files/share/${z.params.id}`);J.value=a,a.code||(I.value=!0)}catch(a){l.error("分享链接无效或已过期"),A.push("/home")}})),(a,e)=>{const s=m,l=i,r=u,$=n,C=g,V=v,z=w;return j(),t("div",x,[o(z,{class:"share-card"},{header:c((()=>[o(s,null,{default:c((()=>[o(p(k)),y("span",null,b(J.value.originalName),1)])),_:1})])),default:c((()=>[I.value?(j(),d(s,{key:1,direction:"vertical",size:"large"},{default:c((()=>[o(s,null,{default:c((()=>[o($,{theme:"primary",onClick:Q},{icon:c((()=>[o(p(_))])),default:c((()=>[e[2]||(e[2]=f(" 下载文件 "))])),_:1,__:[2]}),o($,{onClick:R},{icon:c((()=>[o(p(h))])),default:c((()=>[e[3]||(e[3]=f(" 保存到我的文件 "))])),_:1,__:[3]})])),_:1}),o(V,{data:J.value,columns:N},null,8,["data"])])),_:1})):(j(),d(C,{key:0,data:B.value,ref:"formRef"},{default:c((()=>[o(r,{label:"提取码"},{default:c((()=>[o(l,{modelValue:B.value.code,"onUpdate:modelValue":e[0]||(e[0]=a=>B.value.code=a),placeholder:"请输入提取码"},null,8,["modelValue"])])),_:1}),o(r,null,{default:c((()=>[o($,{theme:"primary",onClick:P},{default:c((()=>e[1]||(e[1]=[f("验证提取码")]))),_:1,__:[1]})])),_:1})])),_:1},8,["data"]))])),_:1})])}}},[["__scopeId","data-v-77f2acb4"]]);export{z as default};
